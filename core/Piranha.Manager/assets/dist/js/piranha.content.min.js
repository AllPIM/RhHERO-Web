piranha.content=new Vue({el:"#content",data:{contentType:null,items:[],features:{useAltTitle:!1,useBlocks:!1,useCategory:!1,useComments:!1,usePrimaryImage:!1,useExcerpt:!1,useHtmlExcerpt:!1,usePublish:!1,useTags:!1,useTranslations:!1},id:null,languageId:null,languageTitle:null,parentId:null,typeId:null,typeTitle:null,groupId:null,groupTitle:null,position:null,meta:null,comments:null,permissions:{selectedPermissions:[],permissions:[]},routes:null,taxonomies:null,title:null,altTitle:null,slug:null,primaryImage:null,excerpt:null,state:null,published:null,publishedTime:null,blocks:[],regions:[],editors:[],languages:[],loading:!0,saving:!1,selectedRegion:"",selectedSetting:"uid-settings"},computed:{contentRegions:function(){return this.regions.filter(function(e){return"setting"!=e.meta.display&&"hidden"!=e.meta.display})},settingRegions:function(){return this.regions.filter(function(e){return"setting"===e.meta.display})},primaryImageUrl:function(){return null!=this.primaryImage.media?piranha.utils.formatUrl("~/manager/api/media/url/"+this.primaryImage.id+"/448/200"):piranha.utils.formatUrl("~/manager/assets/img/empty-image.png")},isExcerptEmpty:function(){return piranha.utils.isEmptyText(this.excerpt)},isPreviewActive:function(){return!this.features.useBlocks&&0===this.regions.length&&0===this.editors.length},isSettingsActive:function(){return!this.isPreviewActive||null!==this.meta||this.features.usePublish||this.features.useAltTitle},metaPriorityDescription:function(){var e=piranha.resources.texts.important;return this.metaPriority<=.3?e=piranha.resources.texts.low:this.metaPriority<=.6?e=piranha.resources.texts.medium:this.metaPriority<=.9&&(e=piranha.resources.texts.high),e+" ("+this.metaPriority+")"}},methods:{reset:function(e){this.contentType=e,this.features.useAltTitle=!1,this.features.useBlocks=!1,this.features.useCategory=!1,this.features.useComments=!1,this.features.usePrimaryImage=!1,this.features.useExcerpt=!1,this.features.useHtmlExcerpt=!1,this.features.usePublish=!1,this.features.useTags=!1,this.features.useTranslations=!1,this.id=null,this.languageId=null,this.languageTitle=null,this.parentId=null,this.typeId=null,this.typeTitle=null,this.groupId=null,this.groupTitle=null,this.position=null,this.meta=null,this.comments=null,this.permissions=null,this.routes=null,this.taxonomies=null,this.title=null,this.altTitle=null,this.slug=null,this.primaryImage=null,this.excerpt=null,this.state=null,this.published=null,this.publishedTime=null,this.blocks=[],this.regions=[],this.editors=[],this.languages=[]},bind:function(e){var t=this;this.features.useAltTitle=e.features.useAltTitle,this.features.useBlocks=e.features.useBlocks,this.features.useCategory=e.features.useCategory,this.features.useComments=e.features.useComments,this.features.usePrimaryImage=e.features.usePrimaryImage,this.features.useExcerpt=e.features.useExcerpt,this.features.useHtmlExcerpt=e.features.useHtmlExcerpt,this.features.usePublish=e.features.usePublish,this.features.useTags=e.features.useTags,this.features.useTranslations=e.features.useTranslations,this.id=e.id,this.languageId=e.languageId,this.languageTitle=e.languageTitle,this.parentId=e.parentId,this.typeId=e.typeId,this.typeTitle=e.typeTitle,this.groupId=e.groupId,this.groupTitle=e.groupTitle,this.position=e.position,this.meta=e.meta,this.comments=e.comments,this.permissions=e.permissions,this.routes=e.routes,this.taxonomies=e.taxonomies,this.title=e.title,this.altTitle=e.altTitle,this.slug=e.slug,this.primaryImage=e.primaryImage,this.excerpt=e.excerpt,this.state=e.state,this.published=e.published,this.publishedTime=e.publishedTime,this.blocks=e.blocks,this.regions=e.regions,this.editors=e.editors,this.languages=e.languages,this.features.useBlocks?this.selectedRegion={uid:"uid-blocks",name:null,icon:null}:this.editors.length>0?this.selectedRegion=this.editors[0]:this.contentRegions.length>0&&(this.selectedRegion=this.contentRegions[0].meta),Vue.nextTick(function(){t.features.useBlocks&&sortable("#content-blocks",{handle:".handle",items:":not(.unsortable)"})[0].addEventListener("sortupdate",function(e){t.moveBlock(e.detail.origin.index,e.detail.destination.index)}),t.features.useCategory&&($("#selectedCategory").select2({tags:!0,selectOnClose:!0,placeholder:piranha.resources.texts.addCategory}),$("#selectedCategory").on("change",function(){var e=$(this).find("option:selected").text();t.taxonomies.selectedCategory=e})),t.features.useTags&&($("#selectedTags").select2({tags:!0,selectOnClose:!1,placeholder:piranha.resources.texts.addTags}),$("#selectedTags").on("change",function(){var e=$(this).find("option:selected");t.taxonomies.selectedTags=[];for(var s=0;s<e.length;s++)t.taxonomies.selectedTags.push(e[s].text)})),t.loading=!1})},load:function(e,t,s){var i=this;this.loading=!0,this.contentType=e;var n=piranha.baseUrl+"manager/api/labs/"+i.contentType+"/"+t;null!=s&&(n+="/"+s),fetch(n).then(function(e){return e.json()}).then(function(t){i.reset(e),i.bind(t)}).catch(function(e){console.log("error:",e)})},loadItems:function(){self=this,fetch(piranha.baseUrl+"manager/api/content/"+self.groupId+"/list").then(function(e){return e.json()}).then(function(e){self.items=e.items.map(function(t){var s=e.types.find(function(e){return e.id===t.typeId});return t.type=s.title||t.typeId,t})}).catch(function(e){console.log("error:",e)})},save:function(){this.saving=!0,this.saveInternal(piranha.baseUrl+"manager/api/labs/"+this.contentType)},saveInternal:function(e){var t=this,s={id:t.id,languageId:t.languageId,parentId:t.parentId,typeId:t.typeId,groupId:t.groupId,position:JSON.parse(JSON.stringify(t.position)),meta:JSON.parse(JSON.stringify(t.meta)),permissions:{selectedPermissions:t.permissions.selectedPermissions},routes:JSON.parse(JSON.stringify(t.routes)),taxonomies:JSON.parse(JSON.stringify(t.taxonomies)),title:t.title,altTitle:t.altTitle,slug:t.slug,primaryImage:{id:t.primaryImage.id},excerpt:t.excerpt,published:t.published,publishedTime:t.publishedTime,blocks:JSON.parse(JSON.stringify(t.blocks)),regions:JSON.parse(JSON.stringify(t.regions))};fetch(e,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)}).then(function(e){return e.json()}).then(function(e){t.bind(e),t.saving=!1}).catch(function(e){console.log("error:",e)})},create:function(e,t){var s=this;fetch(piranha.baseUrl+"manager/api/"+s.contentType+"/create/"+e+"/"+pageType).then(function(e){return e.json()}).then(function(e){s.bind(e)}).catch(function(e){console.log("error:",e)})},addBlock:function(e,t){var s=this;fetch(piranha.baseUrl+"manager/api/content/block/"+e).then(function(e){return e.json()}).then(function(e){s.blocks.splice(t,0,e.body)}).catch(function(e){console.log("error:",e)})},moveBlock:function(e,t){this.blocks.splice(t,0,this.blocks.splice(e,1)[0])},collapseBlock:function(e){e.meta.isCollapsed=!e.meta.isCollapsed},removeBlock:function(e){var t=this.blocks.indexOf(e);-1!==t&&this.blocks.splice(t,1)},updateBlockTitle:function(e){for(var t=0;t<this.blocks.length;t++)if(this.blocks[t].meta.uid===e.uid){this.blocks[t].meta.title=e.title;break}},selectRegion:function(e){this.selectedRegion=e,Vue.nextTick(function(){piranha.editor.refreshMarkdown()})},selectSetting:function(e){this.selectedSetting=e,Vue.nextTick(function(){piranha.editor.refreshMarkdown()})},selectPrimaryImage:function(){null!==this.primaryImage.media?piranha.mediapicker.open(this.updatePrimaryImage,"Image",this.primaryImage.media.folderId):piranha.mediapicker.openCurrentFolder(this.updatePrimaryImage,"Image")},removePrimaryImage:function(){this.primaryImage.id=null,this.primaryImage.media=null},updatePrimaryImage:function(e){"Image"===e.type?(this.primaryImage.id=e.id,this.primaryImage.media=e):console.log("No image was selected")},onExcerptBlur:function(e){this.features.useHtmlExcerpt?this.excerpt=tinyMCE.activeEditor.getContent():this.excerpt=e.target.innerHTML}},updated:function(){},components:{datepicker:vuejsDatepicker}});